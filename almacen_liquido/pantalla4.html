<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantalla 4 â€“ Firma Quien Entrega</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    body{font-family:'Poppins',sans-serif;background:linear-gradient(to right,#00416A,#E4E5E6);margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .contenedor{background:#fff;padding:20px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.3);width:90%;max-width:600px;text-align:center}
    h2{margin-bottom:15px}
    canvas{border:1px solid #ccc;border-radius:8px;width:100%;height:250px;touch-action:none}
    button{padding:10px 16px;margin:10px;border:none;border-radius:6px;cursor:pointer;font-size:15px}
    .btn-limpiar{background:#0c6cbd;color:#fff}
    .btn-limpiar:hover{background:#0a4e8c}
    .btn-continuar{background:#22aa22;color:#fff}
    .btn-continuar:hover{background:#187a18}
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>Firma â€“ Quien Entrega</h2>
    <canvas id="canvasFirma"></canvas>
    <div>
      <button class="btn-limpiar" onclick="limpiar()">ðŸ§¹ Limpiar</button>
      <button class="btn-continuar" onclick="continuar()">âœ… Continuar</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("canvasFirma");
    const ctx = canvas.getContext("2d");
    let dibujando = false;

    // Ajustar tamaÃ±o real del canvas
    function ajustarCanvas(){
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    window.onload = ajustarCanvas;
    window.onresize = ajustarCanvas;

    // PosiciÃ³n corregida dentro del canvas
    function getPosicion(event){
      const rect = canvas.getBoundingClientRect();
      if(event.touches){
        return {
          x: event.touches[0].clientX - rect.left,
          y: event.touches[0].clientY - rect.top
        };
      }else{
        return {
          x: event.clientX - rect.left,
          y: event.clientY - rect.top
        };
      }
    }

    canvas.addEventListener("mousedown", e => {
      dibujando = true;
      const pos = getPosicion(e);
      ctx.beginPath();
      ctx.moveTo(pos.x,pos.y);
    });

    canvas.addEventListener("mousemove", e => {
      if(!dibujando) return;
      const pos = getPosicion(e);
      ctx.lineTo(pos.x,pos.y);
      ctx.stroke();
    });

    canvas.addEventListener("mouseup", () => dibujando=false);
    canvas.addEventListener("mouseleave", () => dibujando=false);

    // Pantalla tÃ¡ctil
    canvas.addEventListener("touchstart", e => {
      e.preventDefault();
      dibujando = true;
      const pos = getPosicion(e);
      ctx.beginPath();
      ctx.moveTo(pos.x,pos.y);
    });

    canvas.addEventListener("touchmove", e => {
      e.preventDefault();
      if(!dibujando) return;
      const pos = getPosicion(e);
      ctx.lineTo(pos.x,pos.y);
      ctx.stroke();
    });

    canvas.addEventListener("touchend", () => dibujando=false);

    // Limpiar firma
    function limpiar(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    // Guardar firma y pasar a pantalla 5
    function continuar(){
      const firma = canvas.toDataURL();
      localStorage.setItem("firmaEntregaLiquidos", firma);
