<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salida - AlmacÃ©n LÃ­quidos</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right,#00416A,#E4E5E6);
      margin: 0; padding: 0; min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
    }
    .contenedor {
      background: #fff; padding: 20px; border-radius: 12px;
      max-width: 500px; width: 100%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    h2 { text-align: center; color:#00416A; }
    label { font-weight: 600; display:block; margin-top: 12px; }
    input, select {
      width: 100%; padding: 8px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 6px;
    }
    button {
      margin-top: 18px; width: 100%; padding: 12px;
      background: #00416A; color: white; border: none; border-radius: 6px;
      cursor: pointer; font-size: 16px; font-weight: 600;
    }
    button:hover { background: #0c6cbd; }
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>Salida â€“ AlmacÃ©n LÃ­quidos</h2>

    <label for="folio">Folio:</label>
    <input type="text" id="folio" readonly>

    <label for="fecha">Fecha:</label>
    <input type="date" id="fecha" readonly>

    <label for="entrega">Entrega:</label>
    <select id="entrega">
      <option value="">Selecciona quien entrega</option>
      <option value="Arturo Rodriguez Garcia">Arturo Rodriguez Garcia</option>
      <option value="Octavio Cortes Zapata">Octavio Cortes Zapata</option>
    </select>

    <label for="recibe">Recibe:</label>
    <select id="recibe">
      <option value="">Selecciona quien recibe</option>
      <option value="YESENIA URIEGAS MENDOZA">YESENIA URIEGAS MENDOZA</option>
      <option value="PABLO NUÃ‘EZ PALOMINO (PABIN)">PABLO NUÃ‘EZ PALOMINO (PABIN)</option>
      <option value="ELOY SANCHEZ AVENDAÃ‘O">ELOY SANCHEZ AVENDAÃ‘O</option>
      <option value="JUAN MANUEL SALDAÃ‘A BECERRA (JUANITO)">JUAN MANUEL SALDAÃ‘A BECERRA (JUANITO)</option>
      <option value="LUIS ALBERTO PERALES AGUILAR (GUARDIA)">LUIS ALBERTO PERALES AGUILAR (GUARDIA)</option>
      <option value="SANDRA GUADALUPE PATIÃ‘O PEREZ">SANDRA GUADALUPE PATIÃ‘O PEREZ</option>
      <option value="MA ESTHER RODRIGUEZ SIERRA">MA ESTHER RODRIGUEZ SIERRA</option>
      <option value="GAEL HUMBERTO SANCHEZ">GAEL HUMBERTO SANCHEZ</option>
      <option value="JOSE NAPOLEON GARCIA LERMA">JOSE NAPOLEON GARCIA LERMA</option>
      <option value="JUAN CARLOS GONZALEZ TERRAZAS">JUAN CARLOS GONZALEZ TERRAZAS</option>
      <option value="VERONICA ALEJANDRO BECERRA LERMA">VERONICA ALEJANDRO BECERRA LERMA</option>
      <option value="CLAUDIA VERONICA CUELLAR RODRIGUEZ">CLAUDIA VERONICA CUELLAR RODRIGUEZ</option>
      <option value="MARTIN LEOBARDO SERNA ALEMAN">MARTIN LEOBARDO SERNA ALEMAN</option>
      <option value="HEISEL MAIRELI GUERRA DE LA CRUZ">HEISEL MAIRELI GUERRA DE LA CRUZ</option>
      <option value="ROSALVA CARRILLO SANCHEZ">ROSALVA CARRILLO SANCHEZ</option>
      <option value="LIZBETH YAQUELIN LUNA ROQUE">LIZBETH YAQUELIN LUNA ROQUE</option>
      <option value="CHRISTHOFER AARON DAVILA VALDEZ">CHRISTHOFER AARON DAVILA VALDEZ</option>
      <option value="VANIA GALILEA DUARTE VILLARREAL">VANIA GALILEA DUARTE VILLARREAL</option>
      <option value="MIGUEL ANGEL LOPEZ RDZ">MIGUEL ANGEL LOPEZ RDZ</option>
      <option value="ROLANDO RAUL GARZA">ROLANDO RAUL GARZA</option>
      <option value="FERNANDA LOERA">FERNANDA LOERA</option>
      <option value="SANTIAGO MORENO">SANTIAGO MORENO</option>
      <option value="JOSE GERARDO CABRERA TREVIÃ‘O">JOSE GERARDO CABRERA TREVIÃ‘O</option>
      <option value="RODOLFO DAVID OVIEDO INFANTE">RODOLFO DAVID OVIEDO INFANTE</option>
      <option value="LEONARDO DANIEL CUELLAR MARTINEZ">LEONARDO DANIEL CUELLAR MARTINEZ</option>
      <option value="JUAN GABRIEL PEREZ CARRILLO">JUAN GABRIEL PEREZ CARRILLO</option>
      <option value="DORA ALICIA CARDENAS TORRES">DORA ALICIA CARDENAS TORRES</option>
      <option value="JESUS GUADALUPE HERNANDEZ LUNA">JESUS GUADALUPE HERNANDEZ LUNA</option>
      <option value="JUAN ARTURO RODRIGUEZ GARCIA">JUAN ARTURO RODRIGUEZ GARCIA</option>
      <option value="OCTAVIO CORTES ZAPATA">OCTAVIO CORTES ZAPATA</option>
      <option value="JUAN MANUEL ROJAS SANCHEZ">JUAN MANUEL ROJAS SANCHEZ</option>
      <option value="ERICK SAUL RAMIREZ">ERICK SAUL RAMIREZ</option>
      <option value="JUAN MANUEL TAMEZ SERRATO">JUAN MANUEL TAMEZ SERRATO</option>
    </select>

    <label for="destino">Destino:</label>
    <select id="destino">
      <option value="">Selecciona destino</option>
      <option value="MATRIZ PISO">MATRIZ PISO</option>
      <option value="BODEGA ESPECIAS">BODEGA ESPECIAS</option>
    </select>

    <button onclick="guardarDatos()">Guardar y continuar</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
      authDomain: "inventariopv-643f1.firebaseapp.com",
      projectId: "inventariopv-643f1",
      storageBucket: "inventariopv-643f1.appspot.com",
      messagingSenderId: "96242533231",
      appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ðŸ”¹ Cargar folio
    async function cargarFolio() {
      const ref = doc(db, "consecutivos", "salidas_liquido");
      const snap = await getDoc(ref);
      let num = 1;
      if (snap.exists()) num = snap.data().ultimo + 1;
      document.getElementById("folio").value = "SAL-LIQ-" + String(num).padStart(4, "0");
    }

    // ðŸ”¹ Poner fecha actual
    function ponerFechaHoy() {
      const hoy = new Date();
      const yyyy = hoy.getFullYear();
      const mm = String(hoy.getMonth() + 1).padStart(2, '0');
      const dd = String(hoy.getDate()).padStart(2, '0');
      document.getElementById("fecha").value = `${yyyy}-${mm}-${dd}`;
    }

    // ðŸ”¹ Guardar datos y continuar
    async function guardarDatos() {
      const folio = document.getElementById("folio").value;
      const fecha = document.getElementById("fecha").value;
      const entrega = document.getElementById("entrega").value.trim();
      const recibe = document.getElementById("recibe").value.trim();
      const destino = document.getElementById("destino").value.trim();

      if (!folio || !fecha || !entrega || !recibe || !destino) {
        alert("Completa todos los campos.");
        return;
      }

      // Guardar en localStorage
      localStorage.setItem("folio", folio);
      localStorage.setItem("fecha", fecha);
      localStorage.setItem("entrega", entrega);
      localStorage.setItem("recibe", recibe);
      localStorage.setItem("destino", destino);

      // Actualizar consecutivo
      const ref = doc(db, "consecutivos", "salidas_liquido");
      const snap = await getDoc(ref);
      if (snap.exists()) {
        await updateDoc(ref, { ultimo: snap.data().ultimo + 1 });
      } else {
        await setDoc(ref, { ultimo: 1 });
      }

      // Pasar a la pantalla 2
      window.location.href = "almacen_liquido/pantalla2.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      cargarFolio();
      ponerFechaHoy();
    });
  </script>
</body>
</html>
